---
layout:     post
title:      html5新增的observer
subtitle:   html5新增的observer
date:       2018-10-31
author:     NYC
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - web前端
---

# intersectionObserver

## 一个基于intersectionObserver滚动视口的demo

```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <style>
        #box {
            background-color: rgba(40, 40, 190, 255);
            border: 4px solid rgb(20, 20, 120);
            transition: background-color 1s, border 1s;
            width: 350px;
            height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .vertical {
            color: white;
            font: 32px "Arial";
        }
        
        .extra {
            width: 350px;
            height: 350px;
            margin-top: 10px;
            border: 4px solid rgb(20, 20, 120);
            text-align: center;
            padding: 20px;
        }
    </style>
</head>

<body>
    <script>
        var numSteps = 20.0;

        var boxElement;
        var prevRatio = 0.0;
        var increasingColor = "rgba(40, 40, 190, ratio)";
        var decreasingColor = "rgba(190, 40, 40, ratio)";
        window.addEventListener(
            "load",
            function(event) {
                boxElement = document.querySelector("#box");
                createObserver();
            },
            false
        );

        function createObserver() {
            var observer;
            var options = {
                root: null,
                rootMargin: "0px",
                threshold: buildThresholdList()
            };
            observer = new IntersectionObserver(handleIntersect, options);
            observer.observe(boxElement);
            // observer.unobserve(boxElement);
            observer.disconnect();
        }

        function buildThresholdList() {
            var thresholds = [];
            var numSteps = 20;

            for (var i = 1.0; i <= numSteps; i++) {
                var ratio = i / numSteps;
                thresholds.push(ratio);
            }
            console.log(thresholds);
            return thresholds;
        }

        function handleIntersect(entries, observer) {
            entries.forEach(function(entry) {
                if (entry.intersectionRatio > prevRatio) {
                    entry.target.style.backgroundColor = increasingColor.replace(
                        "ratio",
                        entry.intersectionRatio
                    );
                } else {
                    entry.target.style.backgroundColor = decreasingColor.replace(
                        "ratio",
                        entry.intersectionRatio
                    );
                }

                prevRatio = entry.intersectionRatio;
            });
        }
    </script>
    <div style="width:200px;height:1000px"></div>
    <div id="box">
        <div class="vertical">神奇的 <strong>IntersectionObserver</strong></div>
    </div>
    <div style="width:200px;height:1000px"></div>
</body>

</html>
```